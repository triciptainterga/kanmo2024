const E=[];function z(e){for(const t of e.dependencies)t.delete(e);e.dependencies.clear()}function G(e,t){t.add(e),e.dependencies.add(t)}function N(e){const t=new Set;function o(){const s=E[E.length-1];return s&&G(s,t),e}function u(s){e=s;for(const d of[...t])d.execute()}return[o,u]}function D(e){const t={execute(){z(t),E.push(t),e(),E.pop()},dependencies:new Set};t.execute()}function $(e,t){return e.length===t.length&&e.every((o,u)=>o===t[u])}function j(e,t){e.value=t,e.dispatchEvent(new Event("change"))}function J(e,t){const o=e.lastIndexOf(t);o!==-1&&e.splice(o,1)}function g(e,t){const o=document.createElement(e);return Object.assign(o,t)}function A(e,t){return typeof e=="string"?e.split(t):Array.isArray(e)?e.flatMap(o=>typeof o=="string"?o.split(t):[]):[]}const I="use-bootstrap-tag",H=`${I}-target`;function K(e){const t=e.nextElementSibling;t&&t.classList.contains(I)&&t.remove();const o=g("div");e.insertAdjacentElement("afterend",o);const u=e.dataset,s={separator:u.ubTagSeparator||",",variant:u.ubTagVariant||"secondary",xPosition:u.ubTagXPosition||"right",transform:u.ubTagTransform||"input => input",isDuplicate:u.ubTagDuplicate!==void 0,max:+u.ubTagMax>0?+u.ubTagMax:void 0,noInputOnblur:u.ubTagNoInputOnblur!==void 0},d=()=>o.querySelectorAll("button"),B=n=>{n.classList.add("duplicate"),setTimeout(()=>{n.classList.remove("duplicate")},150)},O=()=>e.value,m=()=>O().split(s.separator).filter(n=>n!==""),M=n=>{const a=m(),c=A(n,s.separator);if(!s.max||a.length<s.max){const l=[];!s.isDuplicate&&a.forEach((i,p)=>c.includes(i)&&l.push(p));const r=[];c.forEach(i=>{a.includes(i)?s.isDuplicate&&r.push(i):r.push(i)}),a.push(...r),$(m(),a)||(j(e,a.join(s.separator)),r.forEach(i=>{const p=d()[a.lastIndexOf(i)],_=p.offsetHeight;p.style.height=0,setTimeout(()=>p.style.height=`${_}px`,0),setTimeout(()=>p.style.removeProperty("height"),150)})),s.isDuplicate||l.forEach(i=>B(d()[i]))}else c.length>0&&d().forEach(B)},S=n=>{const a=m();A(n,s.separator).forEach(l=>J(a,l)),$(m(),a)||j(e,a.join(s.separator))},v=e.classList,w=e.disabled;e.tabIndex=-1,v.add(H);const[F,P]=N(e.value),[q,x]=N(!1),[f,b]=N(""),h=()=>F().split(s.separator).filter(n=>n.trim()!==""),U=()=>Function(`return ${s.transform}`)()(f().trim()),V=()=>h().length?"":e.placeholder;o.className=`${I} d-flex flex-wrap align-items-center gap-1 ${v.value}`.replace(H,""),D(()=>{q()?o.classList.add("focus"):o.classList.remove("focus")});const T=()=>{var n;return(n=o.querySelector("input"))==null?void 0:n.focus()},L=n=>{n>=0&&S(h()[n])},k=(n=!1)=>{const a=U();a===""&&b(""),(f().includes(s.separator)||n&&f()!=="")&&(M(a.split(s.separator).filter(c=>c.trim()!=="")),b(""))},y=g("button",{type:"button",className:`align-items-center gap-1 d-inline-flex py-0 border-0 btn btn-${s.variant}`,disabled:w});v.contains("form-control-sm")&&y.classList.add("btn-sm"),v.contains("form-control-lg")&&y.classList.add("btn-lg"),s.xPosition==="left"&&y.classList.add("flex-row-reverse");const C=g("span",{className:"d-inline-flex",role:"button",tabIndex:-1,innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>'}),X=n=>{d().forEach(a=>a.remove()),n.reverse().forEach((a,c)=>{const l=n.length-1-c,r=y.cloneNode();if(r.innerHTML=a,r.onfocus=()=>{r.classList.add("active"),x(!0)},r.onblur=()=>{r.classList.remove("active"),x(!1)},r.onkeydown=({key:i})=>{if(i==="Backspace"||i==="Delete"){L(l);const p=i==="Backspace"?l-1:h().length===l?-1:l;p===-1?T():d()[p].focus()}},!w){const i=C.cloneNode(!0);i.onclick=()=>{L(l),T()},r.append(i)}o.prepend(r)})};if(D(()=>{X(h())}),!w){const n=g("div",{className:"input-wrapper"}),a=g("span"),c=g("input",{type:"text"});c.onfocus=()=>{x(!0)},c.onblur=()=>{x(!1),s.noInputOnblur?b(""):k(!0)},c.onkeydown=l=>{f()===""&&l.key==="Backspace"&&L(h().length-1),f()!==""&&l.key==="Enter"&&(k(!0),l.preventDefault())},c.oninput=()=>{b(c.value),k()},D(()=>{a.innerHTML=f()||V()||"i",c.placeholder=V(),c.value=f()}),n.append(a,c),o.append(n)}return o.onclick=n=>{n.target.tagName!=="BUTTON"&&T()},e.addEventListener("change",()=>{P(e.value)}),e.addEventListener("focus",T),{getValue:O,getValues:m,addValue:M,removeValue:S}}export{K as default};
